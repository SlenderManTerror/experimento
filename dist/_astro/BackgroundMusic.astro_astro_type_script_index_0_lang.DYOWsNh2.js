console.log("üéµ BackgroundMusic component loaded");document.addEventListener("DOMContentLoaded",()=>{console.log("üéµ DOM loaded, starting initialization...");const s=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||window.innerWidth<=768;console.log("üéµ Device detection:",{userAgent:navigator.userAgent,isMobile:s,windowWidth:window.innerWidth,windowHeight:window.innerHeight});const L=document.getElementById("background-music");L&&(L.style.display="none",console.log("üéµ Component audio hidden, using global system"));const e=document.getElementById("music-controls"),m=document.getElementById("drag-handle"),i=document.getElementById("toggle-btn");if(console.log("üéµ Found elements:",{musicControls:!!e,dragHandle:!!m,toggleBtn:!!i,windowSize:window.innerWidth+"x"+window.innerHeight}),!e){console.error("üéµ musicControls not found!"),s&&(console.log("üéµ Attempting to create mobile controls manually..."),P());return}let c=!1,d=!1,M,D,y,v;s?(console.log("üéµ Mobile detected - using immediate visibility"),e.classList.add("show"),e.style.transform="translateY(0)",e.style.opacity="1",e.style.visibility="visible",e.style.display="flex"):setTimeout(()=>{e.classList.add("show"),console.log("üéµ Desktop controls shown via timeout")},500);function x(){if(d=!d,!i)return;const t=i.querySelector(".chevron-left"),n=i.querySelector(".chevron-right");d?(e&&e.classList.add("minimized"),t&&t.classList.add("hidden"),n&&n.classList.remove("hidden"),i.title="Mostrar controles"):(e&&e.classList.remove("minimized"),t&&t.classList.remove("hidden"),n&&n.classList.add("hidden"),i.title="Ocultar controles"),localStorage.setItem("music-controls-minimized",d.toString()),console.log("üéµ Controls",d?"minimized":"expanded")}i&&(i.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),x()}),s&&i.addEventListener("touchend",t=>{t.preventDefault(),t.stopPropagation(),x()}),console.log("üéµ Toggle listener added"));function E(t){if(c=!0,e&&e.classList.add("dragging"),!e)return;const n=e.getBoundingClientRect();y=n.left,v=n.top;const r=t.touches?t.touches[0].clientX:t.clientX,l=t.touches?t.touches[0].clientY:t.clientY;M=r-y,D=l-v,e.style.left=y+"px",e.style.top=v+"px",e.style.right="auto",e.style.bottom="auto"}function Y(t){if(!c)return;const n=t.touches?t.touches[0].clientX:t.clientX,r=t.touches?t.touches[0].clientY:t.clientY;let l=n-M,g=r-D;if(!e)return;const p=e.getBoundingClientRect(),a=window.innerWidth-p.width-10,f=window.innerHeight-p.height-10;l=Math.max(10,Math.min(l,a)),g=Math.max(10,Math.min(g,f)),e.style.left=l+"px",e.style.top=g+"px"}function X(){if(c&&(c=!1,e&&e.classList.remove("dragging"),e)){const t=e.getBoundingClientRect();localStorage.setItem("music-controls-position",JSON.stringify({x:t.left,y:t.top}))}}m&&(m.addEventListener("mousedown",E),s&&m.addEventListener("touchstart",t=>{t.preventDefault(),t.stopPropagation(),E(t)},{passive:!1}),console.log("üéµ Drag listeners added")),document.addEventListener("mousemove",Y),document.addEventListener("mouseup",X),s&&(document.addEventListener("touchmove",t=>{c&&(t.preventDefault(),t.stopPropagation()),Y(t)},{passive:!1}),document.addEventListener("touchend",t=>{c&&(t.preventDefault(),t.stopPropagation()),X()},{passive:!1}));const C=localStorage.getItem("music-controls-position");if(C)try{const{x:t,y:n}=JSON.parse(C);e.style.left=t+"px",e.style.top=n+"px",e.style.right="auto",e.style.bottom="auto",console.log("üéµ Position restored")}catch{console.log("üéµ Could not restore position")}localStorage.getItem("music-controls-minimized")==="true"&&x(),console.log("üéµ Component ready"),s&&setTimeout(()=>{const t=e.offsetHeight>0&&e.offsetWidth>0;console.log("üéµ Mobile visibility check:",{isVisible:t,offsetHeight:e.offsetHeight,offsetWidth:e.offsetWidth,computedDisplay:window.getComputedStyle(e).display,computedOpacity:window.getComputedStyle(e).opacity})},1e3);function P(){console.log("üéµ Creating emergency mobile controls...");const t=document.querySelector(".background-music-container");if(t){const n=document.createElement("div");n.id="music-controls",n.className="music-controls show",n.style.cssText=`
                    position: fixed;
                    bottom: 20px;
                    right: 20px;
                    background: rgba(0,0,0,0.8);
                    padding: 14px 20px;
                    border-radius: 25px;
                    display: flex;
                    gap: 12px;
                    z-index: 99999;
                    min-height: 50px;
                    align-items: center;
                `,n.innerHTML=`
                    <div style="color:rgba(255,255,255,0.5);cursor:grab;padding:8px 6px;font-size:14px;user-select:none;touch-action:none;min-width:24px;display:flex;align-items:center;justify-content:center;">‚ãÆ‚ãÆ</div>
                    <button style="background:none;border:none;color:white;padding:8px;border-radius:50%;width:44px;height:44px;display:flex;align-items:center;justify-content:center;font-size:18px;">‚ñ∂Ô∏è</button>
                    <button style="background:none;border:none;color:white;padding:8px;border-radius:50%;width:44px;height:44px;display:flex;align-items:center;justify-content:center;font-size:18px;">üîä</button>
                `,t.appendChild(n),console.log("üéµ Emergency controls created");const r=n.querySelector("div");if(r){let l=function(o){a=!0,n.style.transition="none";const h=n.getBoundingClientRect();S=h.left,B=h.top;const w=o.touches?o.touches[0].clientX:o.clientX,u=o.touches?o.touches[0].clientY:o.clientY;f=w-S,z=u-B,o.preventDefault(),o.stopPropagation()},g=function(o){if(!a)return;const h=o.touches?o.touches[0].clientX:o.clientX,w=o.touches?o.touches[0].clientY:o.clientY;let u=h-f,b=w-z;const H=n.getBoundingClientRect(),k=window.innerWidth-H.width-10,I=window.innerHeight-H.height-10;u=Math.max(10,Math.min(u,k)),b=Math.max(10,Math.min(b,I)),n.style.left=u+"px",n.style.top=b+"px",n.style.right="auto",n.style.bottom="auto",o.preventDefault(),o.stopPropagation()},p=function(){a&&(a=!1,n.style.transition="")},a=!1,f,z,S,B;r.addEventListener("touchstart",l,{passive:!1}),document.addEventListener("touchmove",g,{passive:!1}),document.addEventListener("touchend",p,{passive:!1})}}}});
