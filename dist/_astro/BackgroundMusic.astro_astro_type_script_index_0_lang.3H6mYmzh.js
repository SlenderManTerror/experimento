console.log("üéµ BackgroundMusic component loaded");document.addEventListener("DOMContentLoaded",()=>{console.log("üéµ DOM loaded, starting initialization...");const r=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||window.innerWidth<=768;console.log("üéµ Device detection:",{userAgent:navigator.userAgent,isMobile:r,windowWidth:window.innerWidth,windowHeight:window.innerHeight});const P=document.getElementById("background-music");P&&(P.style.display="none",console.log("üéµ Component audio hidden, using global system"));const n=document.getElementById("music-controls"),y=document.getElementById("drag-handle"),d=document.getElementById("toggle-btn");if(console.log("üéµ Found elements:",{musicControls:!!n,dragHandle:!!y,toggleBtn:!!d,windowSize:window.innerWidth+"x"+window.innerHeight}),!n){console.error("üéµ musicControls not found!"),r&&(console.log("üéµ Attempting to create mobile controls manually..."),q());return}let g=!1,p=!1,Y,N,D,S;r?(console.log("üéµ Mobile detected - using immediate visibility"),n.classList.add("show"),n.style.transform="translateY(0)",n.style.opacity="1",n.style.visibility="visible",n.style.display="flex"):setTimeout(()=>{n.classList.add("show"),console.log("üéµ Desktop controls shown via timeout")},500);function I(){if(p=!p,!d)return;const e=d.querySelector(".chevron-left"),t=d.querySelector(".chevron-right");p?(n&&n.classList.add("minimized"),e&&e.classList.add("hidden"),t&&t.classList.remove("hidden"),d.title="Mostrar controles"):(n&&n.classList.remove("minimized"),e&&e.classList.remove("hidden"),t&&t.classList.add("hidden"),d.title="Ocultar controles"),localStorage.setItem("music-controls-minimized",p.toString()),console.log("üéµ Controls",p?"minimized":"expanded")}d&&(d.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),I()}),r&&d.addEventListener("touchend",e=>{e.preventDefault(),e.stopPropagation(),I()}),console.log("üéµ Toggle listener added"));function O(e){if(g=!0,n&&n.classList.add("dragging"),!n)return;const t=n.getBoundingClientRect();D=t.left,S=t.top;const o=e.touches?e.touches[0].clientX:e.clientX,i=e.touches?e.touches[0].clientY:e.clientY;Y=o-D,N=i-S,n.style.left=D+"px",n.style.top=S+"px",n.style.right="auto",n.style.bottom="auto"}function X(e){if(!g)return;const t=e.touches?e.touches[0].clientX:e.clientX,o=e.touches?e.touches[0].clientY:e.clientY;let i=t-Y,s=o-N;if(!n)return;const u=n.getBoundingClientRect(),m=window.innerWidth-u.width-10,x=window.innerHeight-u.height-10;i=Math.max(10,Math.min(i,m)),s=Math.max(10,Math.min(s,x)),n.style.left=i+"px",n.style.top=s+"px"}function B(){if(g&&(g=!1,n&&n.classList.remove("dragging"),n)){const e=n.getBoundingClientRect();localStorage.setItem("music-controls-position",JSON.stringify({x:e.left,y:e.top}))}}y&&(y.addEventListener("mousedown",O),r&&y.addEventListener("touchstart",e=>{e.preventDefault(),e.stopPropagation(),O(e)},{passive:!1}),console.log("üéµ Drag listeners added")),document.addEventListener("mousemove",X),document.addEventListener("mouseup",B),r&&(document.addEventListener("touchmove",e=>{g&&(e.preventDefault(),e.stopPropagation()),X(e)},{passive:!1}),document.addEventListener("touchend",e=>{g&&(e.preventDefault(),e.stopPropagation()),B()},{passive:!1}));const F=localStorage.getItem("music-controls-position");if(F)try{const{x:e,y:t}=JSON.parse(F);n.style.left=e+"px",n.style.top=t+"px",n.style.right="auto",n.style.bottom="auto",console.log("üéµ Position restored")}catch{console.log("üéµ Could not restore position")}localStorage.getItem("music-controls-minimized")==="true"&&I(),console.log("üéµ Component ready");let f=!1,b=[];function A(){let e=[];try{window.globalAudio&&window.globalAudio instanceof Audio&&(e.push(window.globalAudio),console.log("üéµ FOUND window.globalAudio:",{src:window.globalAudio.src,paused:window.globalAudio.paused,currentTime:window.globalAudio.currentTime,duration:window.globalAudio.duration,loop:window.globalAudio.loop}))}catch(o){console.log("üéµ window.globalAudio not accessible:",o)}[()=>document.getElementById("global-background-music"),()=>document.getElementById("background-music"),()=>document.querySelector("audio[autoplay]"),()=>document.querySelector("audio[loop]"),()=>document.querySelector("audio[src]"),()=>Array.from(document.querySelectorAll("audio")),()=>Array.from(document.querySelectorAll('[src*=".mp3"]')),()=>Array.from(document.querySelectorAll('[src*=".ogg"]')),()=>Array.from(document.querySelectorAll('[src*=".wav"]'))].forEach((o,i)=>{try{const s=o();s&&(Array.isArray(s)?e.push(...s.filter(u=>u instanceof HTMLAudioElement)):s instanceof HTMLAudioElement&&e.push(s))}catch(s){console.log(`üéµ Search ${i} failed:`,s)}});try{for(const o in window)try{const i=window[o];i&&i instanceof Audio&&(e.push(i),console.log(`üéµ FOUND audio in window.${o}`))}catch{}}catch(o){console.log("üéµ Window scan failed:",o)}return b=Array.from(new Set(e)),console.log(`üéµ TOTAL FOUND: ${b.length} audio elements:`,b.map(o=>({id:o.id||"no-id",src:o.src||"no-src",paused:o.paused,currentTime:o.currentTime,loop:o.loop,constructor:o.constructor.name}))),b}function v(){const e=A();let t=!1;try{window.globalAudio&&!window.globalAudio.paused&&(console.log("üéµ PAUSING window.globalAudio:",{src:window.globalAudio.src||"no-src",currentTime:window.globalAudio.currentTime,duration:window.globalAudio.duration}),window.globalAudio.pause(),t=!0,f=!0)}catch(o){console.log("üéµ Could not pause window.globalAudio:",o)}if(e.forEach((o,i)=>{o&&!o.paused&&(console.log(`üéµ PAUSING audio ${i}:`,{id:o.id||"no-id",src:o.src||"no-src",currentTime:o.currentTime,duration:o.duration}),o.pause(),t=!0,f=!0)}),window.AudioContext||window.webkitAudioContext)try{(window.__audioContexts__||[]).forEach((i,s)=>{i.state==="running"&&(i.suspend(),t=!0,f=!0,console.log(`üéµ SUSPENDED AudioContext ${s}`))})}catch(o){console.log("üéµ AudioContext error:",o)}t?console.log("üéµ ‚úÖ AUDIO SUCCESSFULLY PAUSED"):(console.log("üéµ ‚ùå NO PLAYING AUDIO FOUND"),setTimeout(()=>{const o=document.querySelectorAll("*");let i=!1;o.forEach(s=>{if(s.pause&&!s.paused)try{s.pause(),i=!0,console.log("üéµ RETRY: Found and paused element:",s.tagName,s.id)}catch{}}),i||console.log("üéµ RETRY: Still no audio found")},100))}function E(){if(!f)return;let e=!1;try{if(window.globalAudio&&window.globalAudio.paused){f=!1,setTimeout(()=>{window.globalAudio.play().catch(o=>{console.log("üéµ Resume failed for window.globalAudio:",o)}),console.log("üéµ ‚úÖ RESUMED window.globalAudio")},100),e=!0;return}}catch(o){console.log("üéµ Could not resume window.globalAudio:",o)}const t=A();for(const o of t)if(o&&o.paused){f=!1,setTimeout(()=>{o.play().catch(i=>{console.log("üéµ Resume failed for:",o.id||"unnamed",i)}),console.log("üéµ RESUMED audio:",o.id||"unnamed")},100),e=!0;break}e||console.log("üéµ ‚ùå No paused audio found to resume")}let h=0;setTimeout(()=>{console.log("üéµ Starting audio detection system..."),h=A().length,h>0?console.log(`üéµ ‚úÖ INITIAL DETECTION: Found ${h} audio elements`):console.log("üéµ No audio found initially, will keep searching..."),setInterval(()=>{const t=A();t.length>h&&(h=t.length,console.log(`üéµ ‚úÖ NEW AUDIO DETECTED! Total: ${t.length}`))},2e3)},1e3);let c=!0,a=0;document.addEventListener("visibilitychange",()=>{const e=document.hidden;console.log("üéµ Page visibility:",e?"HIDDEN":"VISIBLE"),e?(console.log("üéµ Page is HIDDEN - pausing audio"),c=!1,v()):(console.log("üéµ Page is VISIBLE - resuming audio"),c=!0,E(),a=0)});let C=null;window.addEventListener("blur",()=>{console.log("üéµ Window BLUR detected"),C=setTimeout(()=>{!document.hidden&&document.hasFocus()===!1&&(console.log("üéµ Confirmed focus loss - pausing audio"),c=!1,v())},500)}),window.addEventListener("focus",()=>{console.log("üéµ Window FOCUS detected"),C&&clearTimeout(C),c||(console.log("üéµ Confirmed focus gain - resuming audio"),c=!0,E(),a=0)}),setInterval(()=>{const e=document.hasFocus(),t=!document.hidden;!e&&!t&&c?(a++,console.log(`üéµ POLLING: Focus loss detected (${a})`),a>=3&&(console.log("üéµ POLLING: Confirmed sustained focus loss - pausing"),c=!1,v())):e&&t&&!c?(console.log("üéµ POLLING: Focus regained - resuming"),c=!0,E(),a=0):(e||t)&&(a=0)},1e3);let R=Date.now();function W(){R=Date.now(),a=0,c||(console.log("üéµ User interaction detected - ensuring audio is active"),c=!0,E())}["click","keydown","scroll","touchstart","mousemove"].forEach(e=>{document.addEventListener(e,W,!0)}),setInterval(()=>{Date.now()-R>6e5&&!document.hasFocus()&&document.hidden&&c&&(console.log("üéµ EXTREME INACTIVITY: 10+ minutes without interaction"),c=!1,v())},6e4),console.log("üéµ BRUTE FORCE auto-pause system activated"),r&&setTimeout(()=>{const e=n.offsetHeight>0&&n.offsetWidth>0;console.log("üéµ Mobile visibility check:",{isVisible:e,offsetHeight:n.offsetHeight,offsetWidth:n.offsetWidth,computedDisplay:window.getComputedStyle(n).display,computedOpacity:window.getComputedStyle(n).opacity})},1e3);function q(){console.log("üéµ Creating emergency mobile controls...");const e=document.querySelector(".background-music-container");if(e){const t=document.createElement("div");t.id="music-controls",t.className="music-controls show",t.style.cssText=`
                    position: fixed;
                    bottom: 20px;
                    right: 20px;
                    background: rgba(0,0,0,0.8);
                    padding: 14px 20px;
                    border-radius: 25px;
                    display: flex;
                    gap: 12px;
                    z-index: 99999;
                    min-height: 50px;
                    align-items: center;
                `,t.innerHTML=`
                    <button style="background:none;border:none;color:white;padding:8px;border-radius:50%;width:44px;height:44px;display:flex;align-items:center;justify-content:center;font-size:18px;">‚¨ÖÔ∏è</button>
                    <button style="background:none;border:none;color:white;padding:8px;border-radius:50%;width:44px;height:44px;display:flex;align-items:center;justify-content:center;font-size:18px;">üîä</button>
                    <button style="background:none;border:none;color:white;padding:8px;border-radius:50%;width:44px;height:44px;display:flex;align-items:center;justify-content:center;font-size:18px;">‚ñ∂Ô∏è</button>
                    <div style="color:rgba(255,255,255,0.5);cursor:grab;padding:8px 6px;font-size:14px;user-select:none;touch-action:none;min-width:24px;display:flex;align-items:center;justify-content:center;">‚ãÆ‚ãÆ</div>
                `,e.appendChild(t),console.log("üéµ Emergency controls created");const o=t.querySelector("div:last-child");if(o){let i=function(l){m=!0,t.style.transition="none";const L=t.getBoundingClientRect();k=L.left,z=L.top;const T=l.touches?l.touches[0].clientX:l.clientX,w=l.touches?l.touches[0].clientY:l.clientY;x=T-k,U=w-z,l.preventDefault(),l.stopPropagation()},s=function(l){if(!m)return;const L=l.touches?l.touches[0].clientX:l.clientX,T=l.touches?l.touches[0].clientY:l.clientY;let w=L-x,M=T-U;const H=t.getBoundingClientRect(),$=window.innerWidth-H.width-10,G=window.innerHeight-H.height-10;w=Math.max(10,Math.min(w,$)),M=Math.max(10,Math.min(M,G)),t.style.left=w+"px",t.style.top=M+"px",t.style.right="auto",t.style.bottom="auto",l.preventDefault(),l.stopPropagation()},u=function(){m&&(m=!1,t.style.transition="")},m=!1,x,U,k,z;o.addEventListener("touchstart",i,{passive:!1}),document.addEventListener("touchmove",s,{passive:!1}),document.addEventListener("touchend",u,{passive:!1})}}}});
